$(function(){function k(t){var r=n.getPixelFromCoordinate(t.coordinate),i="";n.forEachFeatureAtPixel(r,function(n){if(n.get("Parcel_Num")!==null){var t=f[0];i="<b>Parcel Number:<\/b><small> "+t.Parcel_Num+"<\/small><br>";i+="<b>Beacons:<\/b><small> "+t.Boundary+"<\/small><br>";i+="<b>Date of Update:<\/b><small> "+t.DateUpdated+"<\/small><br>";i+="<b>Area:<\/b><small> "+t.Area2+" Acres<\/small><br>"}else i="<h3>No Data Here!<h3>"});e.show(t.coordinate,"<div><h4>Parcel Details<\/h4><div>"+i+"<\/div><\/div>")}var t=0,h=function(){document.getElementById("throbber").style.display="block";++t},u=function(){--t;t<=0&&(t=0,document.getElementById("throbber").style.display="none")},c=function(n){n.oldValue&&this.throbberVisible?(u(),this.throbberVisible=!1):n.oldValue||this.throbberVisible||(h(),this.throbberVisible=!0)},l=function(){this.throbberVisible&&(u(),this.throbberVisible=!1)},o,s;const a=document.getElementById("popup"),d=document.getElementById("popup-content"),g=document.getElementById("popup-closer");var v=[new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:3}),fill:new ol.style.Fill({color:"rgba(0, 0, 255, 0.1)"})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"rgba(255, 0, 25,0.8)"})}),geometry:function(n){var t=n.getGeometry().getCoordinates()[0];return new ol.geom.MultiPoint(t)}})],f=[],i=new ol.source.Vector,r=new ol.layer.Vector({source:i,style:v}),y=new ol.proj.Projection({code:"EPSG:3857",units:"m",axisOrientation:"neu"});const p=new ol.Overlay({element:a,autoPan:!0,autoPanAnimation:{duration:250}});var w=new ol.View({center:[4098004.08,-142987.72],maxZoom:30,zoom:18,projection:y}),b=new ol.layer.Tile({source:new ol.source.OSM}),n=new ol.Map({layers:[b],target:document.getElementById("map"),view:w,overlays:[p]}),e=new Popup;n.addOverlay(e);n.on("pointermove",function(t){if(!t.dragging){var i=n.getEventPixel(t.originalEvent),r=n.forEachLayerAtPixel(i,function(){return!0});n.getTargetElement().style.cursor=r?"pointer":""}});o=(new ol.format.WFS).writeGetFeature({srsName:"EPSG:3857",featureNS:"http://www.intergraph.com/geomedia/gml",featurePrefix:"gmgml",featureTypes:["Parcels"],outputFormat:"application/vnd.geo+json",filter:ol.format.filter.equalTo("Parcel_Num",routeId)});s=(new XMLSerializer).serializeToString(o);fetch("https://demo.osl.co.ke:7575/LIMSParcels2/service.svc/post",{method:"POST",body:s,headers:new Headers({"Content-Type":"application/xml"})}).then(function(n){var t=n.headers.get("content-type");if(console.log(t),t&&t.includes("application/vnd.geo+json"))return n.json();throw new TypeError("Oops, we haven't got JSON!");}).then(function(t){console.log(t);var r=(new ol.format.GeoJSON).readFeatures(t),u=r[0].getProperties();f.push(u);i.addFeatures(r);n.getView().fit(i.getExtent())}).catch(function(n){console.log(`An error occured while processing one of the datasets! 
 ${n}`)});n.on("singleclick",k);r.on("change:visible",c);r.on("render",l);n.addLayer(r)});